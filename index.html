<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Infinity · Single File</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
    :root {
      --bg: radial-gradient(circle at top, #0f172a 0%, #020617 50%, #000 100%);
      --panel: rgba(15,23,42,.4);
      --border: rgba(148,163,184,.12);
      --accent: #0ea5e9;
      --text: #e2e8f0;
      --muted: rgba(226,232,240,.55);
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    .topbar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:.55rem .6rem;
      background:rgba(2,6,23,.45);
      border-bottom:1px solid rgba(148,163,184,.03);
    }
    .brand { font-weight:600; font-size:.7rem; }
    .layout { padding:.6rem .6rem 1rem; display:grid; gap:.6rem; }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: .75rem;
      padding: .6rem .65rem .7rem;
    }
    .muted { color:var(--muted); font-size:.58rem; }
    label { display:block; font-size:.6rem; margin-top:.35rem; margin-bottom:.12rem; }
    input {
      width: 100%;
      background: rgba(2,6,23,.4);
      border: 1px solid rgba(148,163,184,.25);
      border-radius: .45rem;
      padding: .3rem .45rem;
      color: #fff;
      font-size: .65rem;
    }
    .btn {
      background: var(--accent);
      border:none;
      border-radius:.45rem;
      padding:.35rem .72rem;
      font-size:.6rem;
      margin-top:.5rem;
      color:#020617;
      cursor:pointer;
    }
    .btn.secondary {
      background: transparent;
      border:1px solid rgba(148,163,184,.35);
      color:#fff;
      margin-left:.3rem;
    }
    .grid {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
      gap:.4rem;
    }
    .tile {
      background: rgba(2,6,23,.25);
      border:1px solid rgba(148,163,184,.05);
      border-radius:.5rem;
      padding:.35rem .45rem;
      font-size:.58rem;
      text-decoration:none;
      color:inherit;
      text-align:left;
      cursor:pointer;
    }
    .history {
      background:rgba(2,6,23,.25);
      border:1px solid rgba(148,163,184,.04);
      border-radius:.5rem;
      padding:.35rem;
      font-size:.53rem;
      max-height:140px;
      overflow:auto;
      margin-top:.4rem;
    }
    .badge {
      display:inline-block;
      background: rgba(14,165,233,.15);
      border:1px solid rgba(14,165,233,.5);
      border-radius:.4rem;
      padding:.25rem .5rem;
      font-size:.6rem;
      margin-top:.35rem;
    }
    /* auth */
    #screen-login {
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:1rem;
    }
    .auth-box {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: .7rem .7rem .9rem;
      width: min(420px, 100%);
    }
    /* chat */
    .chat-log { background:rgba(2,6,23,.25); border:1px solid rgba(148,163,184,.04); border-radius:.5rem; padding:.4rem; height:180px; overflow:auto; }
    .chat-msg { font-size:.58rem; margin-bottom:.35rem; }
    .chat-msg.me { text-align:right; }
    .chat-input { display:flex; gap:.4rem; margin-top:.4rem; }
    .chat-input input { flex:1; }
    /* radio */
    .progress { height:4px; background:rgba(148,163,184,.13); border-radius:9999px; overflow:hidden; margin-top:.45rem; }
    .progress-inner { height:4px; width:0%; background:#0ea5e9; }
    /* marketplace */
    .img-preview { width:100%; max-width:260px; border-radius:.6rem; margin-top:.4rem; }
  </style>
</head>
<body>
  <header class="topbar" id="topbar" style="display:none;">
    <div class="brand">Infinity</div>
    <div>
      <button class="btn secondary" onclick="route('#portal')">Portal</button>
      <button class="btn secondary" onclick="route('#marketplace')">Market</button>
      <button class="btn secondary" onclick="route('#bank')">Bank</button>
      <button class="btn secondary" onclick="route('#radio')">Radio</button>
      <button class="btn secondary" onclick="route('#rogers')">Rogers</button>
    </div>
  </header>

  <!-- LOGIN SCREEN -->
  <div id="screen-login">
    <div class="auth-box">
      <h1>Infinity</h1>
      <p class="muted">Single sign-in, shared wallet, single file.</p>
      <label>Display name</label>
      <input id="login-name" placeholder="Kris">
      <label>Email (optional)</label>
      <input id="login-email" type="email" placeholder="you@example.com">
      <button class="btn" onclick="doLogin()">Enter Infinity</button>
      <button class="btn secondary" onclick="doBypass()">Bypass / Admin</button>
    </div>
  </div>

  <!-- PORTAL -->
  <main class="layout" id="screen-portal" style="display:none;">
    <section class="card">
      <h2>Infinity Bank / Wallet</h2>
      <p class="muted">Tokens across all sections.</p>
      <div id="walletBalance" class="badge">0 INF</div>
      <div class="grid" style="margin-top:.4rem;">
        <button class="btn" onclick="earn('build-app',10)">+10 Build App</button>
        <button class="btn" onclick="earn('marketplace-action',5)">+5 Marketplace</button>
        <button class="btn secondary" onclick="renderWalletHistory()">View history</button>
      </div>
      <div id="walletHistory" class="history">No history yet.</div>
    </section>
    <section class="card">
      <h2>Infinity Apps</h2>
      <div class="grid">
        <div class="tile" onclick="route('#marketplace')">Marketplace</div>
        <div class="tile" onclick="route('#rogers')">Rogers Live Chat</div>
        <div class="tile" onclick="route('#bank')">Bank / Wallet</div>
        <div class="tile" onclick="route('#radio')">Radio</div>
      </div>
    </section>
    <section class="card">
      <h2>PewPi Activity</h2>
      <div id="activityBox" class="history">No activity yet.</div>
    </section>
    <div id="footer" class="muted" style="text-align:center;">Powered by Infinity · PewPi v1.0</div>
  </main>

  <!-- MARKETPLACE -->
  <main class="layout" id="screen-marketplace" style="display:none;">
    <section class="card">
      <h2>Quick list from photo</h2>
      <p class="muted">Pick or take a photo, we draft the listing.</p>
      <input type="file" id="mp-photo" accept="image/*" capture="environment">
      <img id="mp-preview" class="img-preview" style="display:none;">
      <label>Title</label>
      <input id="mp-title" placeholder="Coin / jewelry / tool">
      <label>Description</label>
      <input id="mp-desc" placeholder="Listing created from photo. Add details.">
      <label>Price (USD)</label>
      <input id="mp-price" type="number" placeholder="25.00">
      <button class="btn" onclick="saveListing()">Save listing</button>
    </section>
    <section class="card">
      <h2>Your listings</h2>
      <div id="mp-list" class="history">No items yet.</div>
    </section>
  </main>

  <!-- BANK VIEW -->
  <main class="layout" id="screen-bank" style="display:none;">
    <section class="card">
      <h2>Wallet</h2>
      <div id="bank-balance" class="badge">0 INF</div>
      <p class="muted">Same wallet as portal.</p>
    </section>
    <section class="card">
      <h2>Wallet history</h2>
      <div id="bank-history" class="history">No history yet.</div>
    </section>
    <section class="card">
      <h2>PewPi Activity</h2>
      <div id="bank-activity" class="history">No activity yet.</div>
    </section>
  </main>

  <!-- ROGERS CHAT -->
  <main class="layout" id="screen-rogers" style="display:none;">
    <section class="card">
      <h2>Rogers AI</h2>
      <div id="chatLog" class="chat-log"></div>
      <div class="chat-input">
        <input id="chatText" placeholder="Ask to build listing, portal, marketplace...">
        <button class="btn" onclick="sendChat()">Send</button>
      </div>
    </section>
  </main>

  <!-- RADIO -->
  <main class="layout" id="screen-radio" style="display:none;">
    <section class="card">
      <h2>Infinity Radio</h2>
      <p class="muted">Instrumental / easy listening style. Tap to start (mobile rule).</p>
      <div class="grid">
        <div class="tile" onclick="setChannel('instrumental')">Instrumental</div>
        <div class="tile" onclick="setChannel('easy')">Easy</div>
      </div>
      <div style="margin-top:.4rem;">
        <div class="muted" id="radio-now">No track</div>
        <button class="btn" onclick="toggleRadio()">Play / Pause</button>
        <div class="progress"><div id="radio-progress" class="progress-inner"></div></div>
      </div>
      <audio id="radio-audio" preload="none"></audio>
    </section>
  </main>

  <script>
    // ============== CORE STORAGE ==============
    const AUTH_KEY = "infinity:user";
    const WALLET_KEY = "infinity:wallets";
    const ACT_KEY = "infinity:activity";
    const LIST_KEY = "infinity:market:listings";
    let currentChannel = "instrumental";

    function getUser() {
      const raw = localStorage.getItem(AUTH_KEY);
      return raw ? JSON.parse(raw) : null;
    }
    function setUser(u) {
      localStorage.setItem(AUTH_KEY, JSON.stringify(u));
    }
    function userKey(u) {
      return u.email && u.email.length ? u.email : u.name;
    }
    function getWalletStore() {
      const raw = localStorage.getItem(WALLET_KEY);
      return raw ? JSON.parse(raw) : {};
    }
    function setWalletStore(s) {
      localStorage.setItem(WALLET_KEY, JSON.stringify(s));
    }
    function ensureWallet(u) {
      const store = getWalletStore();
      const key = userKey(u);
      if (!store[key]) {
        store[key] = { tokens: 0, history: [] };
        setWalletStore(store);
      }
      return store[key];
    }
    function logActivity(u, action) {
      const raw = localStorage.getItem(ACT_KEY);
      const list = raw ? JSON.parse(raw) : [];
      list.unshift({
        ts: new Date().toISOString(),
        user: u.name || "user",
        action
      });
      localStorage.setItem(ACT_KEY, JSON.stringify(list.slice(0,200)));
    }
    function getActivity() {
      const raw = localStorage.getItem(ACT_KEY);
      return raw ? JSON.parse(raw) : [];
    }
    function reward(u, action, amount) {
      const store = getWalletStore();
      const key = userKey(u);
      const w = store[key] || { tokens:0, history:[] };
      w.tokens += amount;
      w.history.unshift({
        ts: new Date().toISOString(),
        action,
        amount
      });
      store[key] = w;
      setWalletStore(store);
      logActivity(u, action);
      return w;
    }

    // ============== LOGIN ==============
    function doLogin() {
      const name = document.getElementById("login-name").value.trim();
      const email = document.getElementById("login-email").value.trim();
      if (!name && !email) { alert("Enter name or email"); return; }
      const user = { name, email, ts: Date.now(), source: "login" };
      setUser(user);
      ensureWallet(user);
      logActivity(user, "login");
      showApp();
      route('#portal');
    }
    function doBypass() {
      const user = { name: "Infinity Admin", email: "", ts: Date.now(), source: "bypass" };
      setUser(user);
      ensureWallet(user);
      logActivity(user, "bypass-login");
      showApp();
      route('#portal');
    }
    function showApp() {
      document.getElementById("screen-login").style.display = "none";
      document.getElementById("topbar").style.display = "flex";
      document.getElementById("screen-portal").style.display = "grid";
      renderPortal();
    }

    // ============== ROUTING ==============
    function hideAll() {
      document.getElementById("screen-portal").style.display = "none";
      document.getElementById("screen-marketplace").style.display = "none";
      document.getElementById("screen-bank").style.display = "none";
      document.getElementById("screen-rogers").style.display = "none";
      document.getElementById("screen-radio").style.display = "none";
    }
    function route(hash) {
      window.location.hash = hash;
      const u = getUser();
      if (!u) return;
      hideAll();
      if (hash === '#portal') {
        document.getElementById("screen-portal").style.display = "grid";
        renderPortal();
      } else if (hash === '#marketplace') {
        document.getElementById("screen-marketplace").style.display = "grid";
        renderListings();
      } else if (hash === '#bank') {
        document.getElementById("screen-bank").style.display = "grid";
        renderBank();
      } else if (hash === '#rogers') {
        document.getElementById("screen-rogers").style.display = "grid";
        initChat();
      } else if (hash === '#radio') {
        document.getElementById("screen-radio").style.display = "grid";
      } else {
        document.getElementById("screen-portal").style.display = "grid";
        renderPortal();
      }
    }
    window.addEventListener('hashchange', () => route(window.location.hash));

    // ============== PORTAL RENDERS ==============
    function renderPortal() {
      const u = getUser();
      if (!u) return;
      const w = ensureWallet(u);
      document.getElementById("walletBalance").textContent = w.tokens + " INF";
      renderWalletHistory();
      const act = getActivity();
      const box = document.getElementById("activityBox");
      box.innerHTML = "";
      if (!act.length) { box.textContent = "No activity yet."; return; }
      act.slice(0,30).forEach(item => {
        const p = document.createElement("p");
        p.textContent = `${item.ts} — ${item.user}: ${item.action}`;
        box.appendChild(p);
      });
    }
    function renderWalletHistory() {
      const u = getUser(); if (!u) return;
      const w = ensureWallet(u);
      const el = document.getElementById("walletHistory");
      el.innerHTML = "";
      if (!w.history.length) { el.textContent = "No history yet."; return; }
      w.history.slice(0,25).forEach(item => {
        const p = document.createElement("p");
        p.textContent = `${item.ts} — ${item.action} (+${item.amount})`;
        el.appendChild(p);
      });
    }
    function earn(action, amount) {
      const u = getUser(); if (!u) return;
      const w = reward(u, action, amount);
      document.getElementById("walletBalance").textContent = w.tokens + " INF";
      renderWalletHistory();
      renderBank();
      alert("+"+amount+" INF");
    }

    // ============== MARKETPLACE ==============
    function getListings() {
      const raw = localStorage.getItem(LIST_KEY);
      return raw ? JSON.parse(raw) : [];
    }
    function setListings(list) {
      localStorage.setItem(LIST_KEY, JSON.stringify(list));
    }
    document.getElementById("mp-photo").onchange = (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      const img = document.getElementById("mp-preview");
      img.src = url;
      img.style.display = "block";
      if (!document.getElementById("mp-title").value) {
        document.getElementById("mp-title").value = "Item from photo";
      }
      if (!document.getElementById("mp-desc").value) {
        document.getElementById("mp-desc").value = "Listing created from photo. Add coin / jewelry / details.";
      }
    };
    function saveListing() {
      const u = getUser(); if (!u) return;
      const title = document.getElementById("mp-title").value.trim();
      const desc = document.getElementById("mp-desc").value.trim();
      const price = document.getElementById("mp-price").value.trim() || "0.00";
      if (!title) { alert("Add a title."); return; }
      const list = getListings();
      list.unshift({
        title, desc, price,
        ts: new Date().toISOString(),
        user: u.name || "user"
      });
      setListings(list);
      reward(u, "marketplace-listing", 5);
      renderListings();
      alert("Listing saved (+5 INF).");
    }
    function renderListings() {
      const box = document.getElementById("mp-list");
      const list = getListings();
      box.innerHTML = "";
      if (!list.length) { box.textContent = "No items yet."; return; }
      list.forEach(item => {
        const p = document.createElement("p");
        p.innerHTML = `<b>${item.title}</b> — $${item.price}<br><span style="opacity:.6;">${item.desc}</span>`;
        box.appendChild(p);
      });
    }

    // ============== BANK ==============
    function renderBank() {
      const u = getUser(); if (!u) return;
      const w = ensureWallet(u);
      document.getElementById("bank-balance").textContent = w.tokens + " INF";
      const bh = document.getElementById("bank-history");
      bh.innerHTML = "";
      if (!w.history.length) { bh.textContent = "No history yet."; } else {
        w.history.slice(0,30).forEach(item => {
          const p = document.createElement("p");
          p.textContent = `${item.ts} — ${item.action} (+${item.amount})`;
          bh.appendChild(p);
        });
      }
      const act = getActivity();
      const ba = document.getElementById("bank-activity");
      ba.innerHTML = "";
      if (!act.length) { ba.textContent = "No activity yet."; } else {
        act.slice(0,30).forEach(a => {
          const p = document.createElement("p");
          p.textContent = `${a.ts} — ${a.user}: ${a.action}`;
          ba.appendChild(p);
        });
      }
    }

    // ============== ROGERS CHAT ==============
    function initChat() {
      const log = document.getElementById("chatLog");
      if (!log.dataset.init) {
        addChat("Rogers online. Tell me what to list.", false);
        log.dataset.init = "1";
      }
    }
    function addChat(text, me) {
      const log = document.getElementById("chatLog");
      const div = document.createElement("div");
      div.className = "chat-msg" + (me ? " me" : "");
      div.textContent = text;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }
    function sendChat() {
      const input = document.getElementById("chatText");
      const val = input.value.trim();
      if (!val) return;
      addChat(val, true);
      input.value = "";
      const u = getUser(); if (u) { reward(u, "rogers-chat", 1); }
      // simple scripted responses
      let reply = "I logged that.";
      if (val.toLowerCase().includes("coin")) reply = "Photo the coin in Marketplace and I'll draft it.";
      if (val.toLowerCase().includes("market")) reply = "Use the Marketplace tab. Each listing = +5 INF.";
      setTimeout(() => addChat(reply, false), 200);
    }

    // ============== RADIO ==============
    const channels = {
      instrumental: [
        "https://archive.org/download/testmp3testfile/mpthreetest.mp3"
      ],
      easy: [
        "https://archive.org/download/SampleAudio_201901/sample.mp3"
      ]
    };
    let radioIndex = 0;
    function setChannel(id) {
      currentChannel = id;
      radioIndex = 0;
      loadRadio(false);
    }
    function loadRadio(play) {
      const audio = document.getElementById("radio-audio");
      const list = channels[currentChannel];
      if (!list) return;
      audio.src = list[radioIndex];
      document.getElementById("radio-now").textContent = currentChannel + " track " + (radioIndex+1);
      if (play) audio.play();
    }
    function toggleRadio() {
      const audio = document.getElementById("radio-audio");
      const u = getUser();
      if (audio.paused) {
        audio.play();
        if (u) reward(u, "radio-play:"+currentChannel, 1);
      } else {
        audio.pause();
      }
    }
    const audio = document.getElementById("radio-audio");
    audio && audio.addEventListener('ended', () => {
      const list = channels[currentChannel];
      radioIndex = (radioIndex + 1) % list.length;
      loadRadio(true);
    });
    audio && audio.addEventListener('timeupdate', () => {
      cons