<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Infinity Vectors · PewPi Login</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
    :root {
      --bg: radial-gradient(circle at top, #0f172a 0%, #020617 50%, #000 100%);
      --panel: rgba(15,23,42,.4);
      --border: rgba(148,163,184,.12);
      --accent: #0ea5e9;
      --text: #e2e8f0;
      --muted: rgba(226,232,240,.55);
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
    }
    .topbar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:.5rem .7rem;
      background:rgba(2,6,23,.55);
      border-bottom:1px solid rgba(148,163,184,.03);
    }
    .brand { font-weight:600; font-size:.7rem; }
    /* login screen */
    #screen-login {
      min-height: 100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:1rem;
    }
    .auth-box {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: .7rem .7rem .9rem;
      width: min(420px, 100%);
    }
    .auth-box h1 { margin:0 0 .4rem; }
    .muted { color: var(--muted); font-size:.58rem; }
    label { display:block; font-size:.6rem; margin-top:.35rem; margin-bottom:.12rem; }
    input {
      width:100%;
      background: rgba(2,6,23,.4);
      border: 1px solid rgba(148,163,184,.25);
      border-radius: .45rem;
      padding: .3rem .45rem;
      color:#fff;
      font-size:.65rem;
    }
    .btn {
      background: var(--accent);
      border: none;
      border-radius: .45rem;
      padding: .35rem .72rem;
      font-size: .6rem;
      margin-top: .5rem;
      color: #020617;
      cursor:pointer;
    }
    .btn.secondary {
      background: transparent;
      border: 1px solid rgba(148,163,184,.35);
      color: #fff;
      margin-left: .35rem;
    }
    /* portal */
    .layout {
      padding:.6rem .6rem 1rem;
      display:grid;
      gap:.6rem;
    }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: .75rem;
      padding: .6rem .65rem .7rem;
    }
    .grid {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(115px, 1fr));
      gap:.4rem;
    }
    .tile {
      background: rgba(2,6,23,.25);
      border: 1px solid rgba(148,163,184,.06);
      border-radius:.5rem;
      padding:.35rem .45rem;
      font-size:.58rem;
      cursor:pointer;
    }
    .history {
      background: rgba(2,6,23,.25);
      border: 1px solid rgba(148,163,184,.04);
      border-radius:.5rem;
      padding:.35rem;
      font-size:.53rem;
      max-height:140px;
      overflow:auto;
      margin-top:.4rem;
    }
    .badge {
      display:inline-block;
      background: rgba(14,165,233,.15);
      border:1px solid rgba(14,165,233,.5);
      border-radius:.4rem;
      padding:.25rem .5rem;
      font-size:.6rem;
      margin-top:.35rem;
    }
    /* spinner placeholder */
    .spinner-box {
      width: 80px;
      height: 80px;
      margin:0 auto .5rem;
      position: relative;
      perspective: 300px;
    }
    .spinner-cube {
      width: 100%;
      height: 100%;
      background: rgba(14,165,233,.3);
      border: 1px solid rgba(14,165,233,.6);
      animation: spin 3s linear infinite;
      transform-style: preserve-3d;
    }
    @keyframes spin {
      from { transform: rotateX(0deg) rotateY(0deg); }
      to { transform: rotateX(360deg) rotateY(360deg); }
    }
  </style>
</head>
<body>
  <!-- topbar (hidden until login) -->
  <header class="topbar" id="topbar" style="display:none;">
    <div class="brand">Infinity Vectors</div>
    <div>
      <button class="btn secondary" onclick="route('#portal')">Portal</button>
      <button class="btn secondary" onclick="route('#market')">Marketplace</button>
      <button class="btn secondary" onclick="route('#pewpi')">PewPi Security</button>
    </div>
  </header>

  <!-- LOGIN -->
  <div id="screen-login">
    <div class="auth-box">
      <div class="spinner-box"><div class="spinner-cube"></div></div>
      <h1>Infinity · PewPi</h1>
      <p class="muted">AI-to-AI encrypted local login. Nothing leaves your browser.</p>
      <label>Username</label>
      <input id="username" placeholder="k.watson">
      <label>Password</label>
      <input id="password" type="password" placeholder="••••••••">
      <button class="btn" onclick="pewpiLogin()">Enter</button>
      <button class="btn secondary" onclick="useBypass()">Bypass / Admin</button>
      <p class="muted" style="margin-top:.5rem;" id="loginStatus"></p>
    </div>
  </div>

  <!-- PORTAL -->
  <main class="layout" id="screen-portal" style="display:none;">
    <section class="card">
      <h2>Welcome back, <span id="uName"></span></h2>
      <p class="muted">Your secure Infinity Portal is protected by PewPi AI-to-AI encryption.</p>
      <div class="badge" id="walletBal">0 INF</div>
      <div class="grid" style="margin-top:.4rem;">
        <div class="tile" onclick="earn('build-app',10)">+10 Build App</div>
        <div class="tile" onclick="earn('market-action',5)">+5 Marketplace</div>
        <div class="tile" onclick="route('#market')">Open Marketplace</div>
        <div class="tile" onclick="route('#pewpi')">PewPi Security</div>
      </div>
    </section>
    <section class="card">
      <h2>Activity Timeline</h2>
      <div id="activityBox" class="history">No activities yet.</div>
    </section>
  </main>

  <!-- MARKETPLACE -->
  <main class="layout" id="screen-market" style="display:none;">
    <section class="card">
      <h2>Quick listing</h2>
      <p class="muted">Photo → fields → save. Stored locally.</p>
      <input type="file" id="mp-photo" accept="image/*" capture="environment">
      <label>Title</label>
      <input id="mp-title" placeholder="Item from photo">
      <label>Description</label>
      <input id="mp-desc" placeholder="Listing created from photo. Add details.">
      <label>Price (USD)</label>
      <input id="mp-price" type="number" placeholder="25.00">
      <button class="btn" onclick="saveListing()">Save listing</button>
    </section>
    <section class="card">
      <h2>Your listings</h2>
      <div id="mp-list" class="history">No items yet.</div>
    </section>
  </main>

  <!-- PEWPI EXPLAINER -->
  <main class="layout" id="screen-pewpi" style="display:none;">
    <section class="card">
      <h2>PewPi Encryption</h2>
      <p class="muted">
        Dual AI-inspired transform. Browser-only. Username-salted. Matches the doc at your /infinity-portal/ version.
      </p>
      <ol class="muted" style="font-size:.55rem;">
        <li>Agent 1: math transform of password → base string</li>
        <li>Agent 2: username-based permutation → final</li>
        <li>Store final in localStorage under this device</li>
        <li>Login = run again and compare</li>
      </ol>
    </section>
  </main>

  <script>
    // ======== storage keys ========
    const PEWPI_USERS_KEY = "infinity:pewpi:users"; // { username: encodedPwd }
    const CURRENT_USER_KEY = "infinity:pewpi:current";
    const ACT_KEY = "infinity:activity";
    const WALLET_KEY = "infinity:wallets";
    const LIST_KEY = "infinity:market:listings";

    // ======== pewpi transforms (recreated from your doc) ========

    // Agent 1: math transform
    function pewpiAgent1(password) {
      // simple prime-based rolling encode
      const PRIME = 131;
      let acc = 7;
      for (let i = 0; i < password.length; i++) {
        acc = (acc * PRIME + password.charCodeAt(i)) >>> 0;
      }
      return acc.toString(16); // hex
    }

    // Agent 2: username-salted permutation
    function pewpiAgent2(agent1Out, username) {
      const salt = username || "anon";
      let combined = agent1Out + "|" + salt.length + "|" + salt;
      // rotate chars based on salt length
      const shift = salt.length % combined.length;
      return combined.slice(shift) + combined.slice(0, shift);
    }

    function pewpiEncode(username, password) {
      const a1 = pewpiAgent1(password);
      return pewpiAgent2(a1, username);
    }

    // ======== local user store ========
    function getUserStore() {
      const raw = localStorage.getItem(PEWPI_USERS_KEY);
      return raw ? JSON.parse(raw) : {};
    }
    function setUserStore(obj) {
      localStorage.setItem(PEWPI_USERS_KEY, JSON.stringify(obj));
    }

    function getCurrentUser() {
      const raw = localStorage.getItem(CURRENT_USER_KEY);
      return raw ? JSON.parse(raw) : null;
    }
    function setCurrentUser(user) {
      localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(user));
    }

    // ======== wallet ========
    function getWalletStore() {
      const raw = localStorage.getItem(WALLET_KEY);
      return raw ? JSON.parse(raw) : {};
    }
    function setWalletStore(store) {
      localStorage.setItem(WALLET_KEY, JSON.stringify(store));
    }
    function ensureWallet(user) {
      const store = getWalletStore();
      const k = user.username;
      if (!store[k]) {
        store[k] = { tokens: 0, history: [] };
        setWalletStore(store);
      }
      return store[k];
    }
    function reward(user, action, amount) {
      const store = getWalletStore();
      const k = user.username;
      const w = store[k] || { tokens:0, history:[] };
      w.tokens += amount;
      w.history.unshift({ ts: new Date().toISOString(), action, amount });
      store[k] = w;
      setWalletStore(store);
      logActivity(user, action);
      return w;
    }

    // ======== activity ========
    function logActivity(user, action) {
      const raw = localStorage.getItem(ACT_KEY);
      const list = raw ? JSON.parse(raw) : [];
      list.unshift({
        ts: new Date().toISOString(),
        user: user.username,
        action
      });
      localStorage.setItem(ACT_KEY, JSON.stringify(list.slice(0,200)));
    }
    function getActivity() {
      const raw = localStorage.getItem(ACT_KEY);
      return raw ? JSON.parse(raw) : [];
    }

    // ======== login flow ========
    function pewpiLogin() {
      const uname = document.getElementById("username").value.trim();
      const pwd = document.getElementById("password").value;
      const status = document.getElementById("loginStatus");
      if (!uname || !pwd) {
        status.textContent = "Enter username and password.";
        return;
      }
      const store = getUserStore();
      const encoded = pewpiEncode(uname, pwd);
      if (!store[uname]) {
        // register new
        store[uname] = encoded;
        setUserStore(store);
        const user = { username: uname, ts: Date.now(), source: "pewpi-register" };
        setCurrentUser(user);
        ensureWallet(user);
        logActivity(user, "register");
        enterPortal(user);
        return;
      }
      // verify
      if (store[uname] === encoded) {
        const user = { username: uname, ts: Date.now(), source: "pewpi-login" };
        setCurrentUser(user);
        ensureWallet(user);
        logActivity(user, "login");
        enterPortal(user);
      } else {
        status.textContent = "Wrong password for this username.";
      }
    }

    function useBypass() {
      const user = { username: "Infinity-Admin", ts: Date.now(), source: "bypass" };
      setCurrentUser(user);
      ensureWallet(user);
      logActivity(user, "bypass-login");
      enterPortal(user);
    }

    function enterPortal(user) {
      document.getElementById("screen-login").style.display = "none";
      document.getElementById("topbar").style.display = "flex";
      document.getElementById("screen-portal").style.display = "grid";
      document.getElementById("uName").textContent = user.username;
      renderPortal(user);
    }

    // ======== router ========
    function hideScreens() {
      document.getElementById("screen-portal").style.display = "none";
      document.getElementById("screen-market").style.display = "none";
      document.getElementById("screen-pewpi").style.display = "none";
    }
    function route(hash) {
      const user = getCurrentUser();
      if (!user) return;
      hideScreens();
      if (hash === '#portal') {
        document.getElementById("screen-portal").style.display = "grid";
        renderPortal(user);
      } else if (hash === '#market') {
        document.getElementById("screen-market").style.display = "grid";
        renderListings();
      } else if (hash === '#pewpi') {
        document.getElementById("screen-pewpi").style.display = "grid";
      } else {
        document.getElementById("screen-portal").style.display = "grid";
        renderPortal(user);
      }
      window.location.hash = hash;
    }
    window.addEventListener('hashchange', () => route(window.location.hash));

    // ======== portal render ========
    function renderPortal(user) {
      const w = ensureWallet(user);
      document.getElementById("walletBal").textContent = w.tokens + " INF";
      const actBox = document.getElementById("activityBox");
      const act = getActivity();
      actBox.innerHTML = "";
      if (!act.length) {
        actBox.textContent = "No activities yet.";
        return;
      }
      act.slice(0,30).forEach(item => {
        const p = document.createElement("p");
        p.textContent = `${item.ts} — ${item.user}: ${item.action}`;
        actBox.appendChild(p);
      });
    }

    function earn(action, amount) {
      const user = getCurrentUser();
      if (!user) return;
      const w = reward(user, action, amount);
      document.getElementById("walletBal").textContent = w.tokens + " INF";
      renderPortal(user);
      alert("+"+amount+" INF");
    }

    // ======== marketplace ========
    function getListings() {
      const raw = localStorage.getItem(LIST_KEY);
      return raw ? JSON.parse(raw) : [];
    }
    function setListings(list) {
      localStorage.setItem(LIST_KEY, JSON.stringify(list));
    }
    function saveListing() {
      const user = getCurrentUser(); if (!user) return;
      const title = document.getElementById("mp-title").value.trim() || "Item from photo";
      const desc = document.getElementById("mp-desc").value.trim();
      const price = document.getElementById("mp-price").value.trim() || "0.00";
      const list = getListings();
      list.unshift({
        title, desc, price,
        ts: new Date().toISOString(),
        user: user.username
      });
      setListings(list);
      reward(user, "marketplace-listing", 5);
      renderListings();
      alert("Listing saved (+5 INF).");
    }
    function renderListings() {
      const box = document.getElementById("mp-list");
      const list = getListings();
      box.innerHTML = "";
      if (!list.length) {
        box.textContent = "No items yet.";
        return;
      }
      list.forEach(item => {
        const p = document.createElement("p");
        p.innerHTML = `<b>${item.title}</b> — $${item.price}<br><span style="opacity:.6;">${item.desc}</span>`;
        box.appendChild(p);
      });
    }

    // ======== boot ========
    document.addEventListener('DOMContentLoaded', () => {
      const u = getCurrentUser();
      if (u) {
        enterPortal(u);
        route(window.location.hash || '#portal');
      }
    });
  </script>
</body>
</html>

  
      
    