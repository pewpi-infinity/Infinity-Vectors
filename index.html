<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Infinity Portal Â· Single File</title>
  <style>
    :root {
      --bg: #0a0f1a;
      --panel: #121829;
      --card: #1a2033;
      --accent: #00d4ff;
      --accent2: #7b2cbf;
      --text: #eef4ff;
      --muted: #8a94a8;
      --danger: #ef4444;
      --success: #22c55e;
      --radius: 14px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(circle at top, #10182a 0%, #060910 60%, #04050a 100%);
      color: var(--text);
      min-height: 100vh;
    }
    a { color: inherit; }

    /* screens */
    .screen {
      display: none;
      min-height: 100vh;
    }
    .screen.show {
      display: block;
    }

    /* login */
    #login-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 30px 16px;
    }
    .login-box {
      background: rgba(8, 10, 18, 0.6);
      backdrop-filter: blur(9px);
      border: 1px solid rgba(0, 212, 255, 0.14);
      border-radius: 16px;
      width: min(400px, 100%);
      padding: 26px 22px 22px;
      box-shadow: 0 18px 50px rgba(0, 0, 0, 0.4);
    }
    .login-title {
      font-size: 21px;
      font-weight: 700;
      margin-bottom: 5px;
    }
    .login-sub {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
    }
    input[type="text"],
    input[type="password"],
    input[type="email"],
    textarea {
      width: 100%;
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(238, 244, 255, 0.05);
      border-radius: 10px;
      padding: 9px 10px;
      color: var(--text);
      font-size: 14px;
      outline: none;
    }
    input:focus, textarea:focus {
      border-color: rgba(0, 212, 255, 0.7);
    }
    .btn {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border: none;
      border-radius: 12px;
      color: #fff;
      font-weight: 600;
      padding: 10px 14px;
      cursor: pointer;
      transition: transform .15s;
    }
    .btn:active {
      transform: translateY(1px);
    }
    .error-msg {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #fecaca;
      border-radius: 10px;
      padding: 8px 10px;
      margin-bottom: 12px;
      font-size: 13px;
      display: none;
    }

    /* main/app header */
    #app-screen {
      min-height: 100vh;
    }
    .topbar {
      background: rgba(10, 14, 24, 0.9);
      border-bottom: 1px solid rgba(0, 212, 255, 0.08);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 18px;
      gap: 10px;
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(12px);
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .brand-title {
      font-weight: 800;
      letter-spacing: .08em;
    }
    .badge-ai {
      background: rgba(0, 212, 255, 0.12);
      border: 1px solid rgba(0, 212, 255, 0.3);
      border-radius: 999px;
      font-size: 11px;
      padding: 3px 9px;
    }
    .user-box {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .pill-btn {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.04);
      border-radius: 999px;
      font-size: 12px;
      padding: 5px 10px;
      cursor: pointer;
    }
    .pill-btn.danger {
      border-color: rgba(239, 68, 68, 0.2);
      color: #fecaca;
      background: rgba(239, 68, 68, 0.05);
    }

    /* layout */
    .content {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px 14px 60px;
      display: grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 20px;
    }
    @media (max-width: 960px) {
      .content {
        grid-template-columns: 1fr;
      }
    }
    .card {
      background: rgba(12, 16, 26, 0.55);
      border: 1px solid rgba(238, 244, 255, 0.03);
      border-radius: 16px;
      padding: 16px 16px 14px;
      margin-bottom: 14px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.18);
    }
    .section-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    .apps-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 14px;
    }
    .app-link {
      background: rgba(255,255,255,0.012);
      border: 1px solid rgba(255,255,255,0.015);
      border-radius: 12px;
      padding: 12px 12px 10px;
      text-decoration: none;
      color: inherit;
      transition: transform .12s;
    }
    .app-link:hover {
      transform: translateY(-2px);
      border-color: rgba(0, 212, 255, 0.3);
    }
    .app-title {
      font-weight: 700;
      margin-bottom: 3px;
    }
    .small {
      font-size: 12px;
      color: var(--muted);
    }

    /* activity log */
    #activity-log {
      max-height: 250px;
      overflow-y: auto;
    }
    .act-item {
      background: rgba(255,255,255,0.012);
      border: 1px solid rgba(255,255,255,0.015);
      border-left: 2px solid var(--accent);
      border-radius: 9px;
      padding: 7px 9px 5px;
      margin-bottom: 9px;
      font-size: 12.5px;
    }
    .act-time {
      color: var(--muted);
      font-size: 11px;
    }

    /* admin panel */
    #admin-panel {
      background: rgba(10, 10, 10, 0.85);
      border-left: 1.4px solid rgba(0, 212, 255, 0.14);
      position: fixed;
      top: 52px;
      right: 0;
      width: min(360px, 100%);
      bottom: 0;
      padding: 12px 10px 40px;
      overflow-y: auto;
      display: none;
      z-index: 200;
      backdrop-filter: blur(14px);
    }
    #admin-panel.show { display: block; }
    .admin-title {
      font-weight: 700;
      margin-bottom: 6px;
    }
    .admin-note {
      font-size: 11.5px;
      color: #f97316;
      margin-bottom: 10px;
      background: rgba(249, 115, 22, 0.07);
      border: 1px solid rgba(249, 115, 22, 0.3);
      border-radius: 10px;
      padding: 6px 7px;
    }
    .admin-group { margin-bottom: 11px; }
    .admin-group small { color: var(--muted); font-size: 11px; }

    .status-ok { color: #bbf7d0; font-size: 12px; }
    .status-bad { color: #fecaca; font-size: 12px; }

    textarea#gh-file-content {
      min-height: 90px;
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .hidden { display: none !important; }
  </style>
</head>
<body>

  <!-- LOGIN SCREEN -->
  <div id="login-screen" class="screen show">
    <div class="login-box">
      <div class="login-title">Infinity Portal Login</div>
      <div class="login-sub">Local login, no server. Type your name. <b>Kris</b> unlocks admin.</div>
      <div id="login-error" class="error-msg"></div>
      <label for="login-name">Your name</label>
      <input id="login-name" type="text" placeholder="e.g. Kris" autocomplete="off" />
      <label for="login-pass" style="margin-top:10px;">Passcode (optional for now)</label>
      <input id="login-pass" type="password" placeholder="leave blank if none" />

      <button class="btn" style="margin-top:16px;width:100%;" onclick="handleLogin()">Enter Portal</button>
    </div>
  </div>

  <!-- APP SCREEN -->
  <div id="app-screen" class="screen">
    <div class="topbar">
      <div class="brand">
        <div class="brand-title">INFINITY</div>
        <div class="badge-ai">AI shadow agent Â· LIVE</div>
      </div>
      <div class="user-box">
        <div id="top-username"></div>
        <button class="pill-btn" id="admin-toggle-btn" onclick="toggleAdmin()" style="display:none;">Admin</button>
        <button class="pill-btn danger" onclick="handleLogout()">Logout</button>
      </div>
    </div>

    <div class="content">
      <!-- LEFT -->
      <div>
        <div class="card">
          <div class="section-title">Welcome back, <span id="welcome-name"></span> ðŸš€</div>
          <p class="small">Your secure Infinity space is active. Upload code, let the agent rewrite it, and push to GitHub from here.</p>
        </div>

        <div class="card">
          <div class="section-title">Apps / Pages / Live</div>
          <div class="apps-grid">
            <a class="app-link" href="#!" onclick="logActivity('portal_open','Portal UI opened');alert('This is a placeholder link.');">
              <div class="app-title">Portal UI</div>
              <div class="small">Day-to-day dashboard</div>
            </a>
            <a class="app-link" href="#!" onclick="alert('Rogers AI placeholder here'); logActivity('portal_open','Rogers AI opened');">
              <div class="app-title">Rogers AI</div>
              <div class="small">Chat/terminal style</div>
            </a>
            <a class="app-link" href="#!" onclick="alert('Live tools placeholder'); logActivity('portal_open','Live tools opened');">
              <div class="app-title">Live / Stream</div>
              <div class="small">Camera â€¢ Mic â€¢ Screen</div>
            </a>
            <a class="app-link" href="#!" onclick="alert('Uploader placeholder'); logActivity('upload_open','Uploader opened');">
              <div class="app-title">Uploader</div>
              <div class="small">Drop code/snippets</div>
            </a>
          </div>
        </div>

        <div class="card">
          <div class="section-title">Activity log</div>
          <div id="activity-log"></div>
          <button class="pill-btn danger" style="margin-top:10px;" onclick="clearActivity()">Clear activity</button>
        </div>
      </div>

      <!-- RIGHT -->
      <div>
        <div class="card">
          <div class="section-title">Quick Script Drop</div>
          <p class="small">Paste HTML/JS/CSS here and the agent will keep it in local storage. Admin can push to GitHub.</p>
          <textarea id="quick-script" placeholder="Paste code here..."></textarea>
          <button class="btn" style="margin-top:10px;" onclick="saveLocalSnippet()">Save locally</button>
          <div id="local-snippet-status" class="small" style="margin-top:6px;"></div>
        </div>

        <div class="card">
          <div class="section-title">Saved snippets (local)</div>
          <div id="snippet-list" class="small"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ADMIN PANEL (only for Kris) -->
  <div id="admin-panel">
    <div class="admin-title">Admin Â· GitHub Writer</div>
    <div class="admin-note">
      Only shows for Kris. Browser will talk straight to GitHub. If your browser blocks it (CORS), serve this page from localhost or a domain.
    </div>

    <div class="admin-group">
      <label for="gh-user">GitHub Repo (owner/repo)</label>
      <input id="gh-user" type="text" placeholder="pewpi-infinity/Infinity-Vectors" />
      <small>Use your real repo name.</small>
    </div>

    <div class="admin-group">
      <label for="gh-token">Personal Access Token</label>
      <input id="gh-token" type="password" placeholder="ghp_..." />
      <small>Make a PAT on GitHub â†’ Settings â†’ Developer settings â†’ PAT. Scope: <code>repo</code>.</small>
    </div>

    <div class="admin-group">
      <label for="gh-path">File path in repo</label>
      <input id="gh-path" type="text" value="web/infinity/index.html" />
      <small>Example: <code>index.html</code> or <code>web/infinity/index.html</code></small>
    </div>

    <div class="admin-group">
      <label for="gh-message">Commit message</label>
      <input id="gh-message" type="text" value="Infinity auto-commit from portal" />
    </div>

    <div class="admin-group">
      <label for="gh-file-content">File content to push</label>
      <textarea id="gh-file-content" placeholder="Paste the page / generated script here..."></textarea>
    </div>

    <button class="btn" onclick="pushToGithub()">Push to GitHub</button>
    <div id="gh-status" style="margin-top:8px;" class="small"></div>

    <hr style="margin:14px 0;border:0;border-top:1px solid rgba(255,255,255,0.03);" />

    <div class="admin-group">
      <div class="admin-title">Admin tools</div>
      <button class="pill-btn" onclick="dumpLocal()">Dump localStorage to console</button>
      <button class="pill-btn danger" onclick="localStorage.clear();alert('localStorage cleared');">Wipe localStorage</button>
    </div>
  </div>

  <script>
    // ========= BASIC LOGIN =========
    const ADMIN_NAME = "kris"; // case-insensitive
    const LS_USER_KEY = "infinity_current_user";
    const LS_ACTIVITY_KEY = "infinity_activity";
    const LS_SNIPPETS_KEY = "infinity_snippets";
    const LS_GH_SETTINGS = "infinity_github_settings";

    function handleLogin() {
      const name = document.getElementById("login-name").value.trim();
      const err = document.getElementById("login-error");
      if (!name) {
        err.textContent = "Enter your name.";
        err.style.display = "block";
        return;
      }
      err.style.display = "none";
      localStorage.setItem(LS_USER_KEY, name);
      showApp(name);
      logActivity("login", "User logged in: " + name);
    }

    function showApp(name) {
      document.getElementById("login-screen").classList.remove("show");
      document.getElementById("app-screen").classList.add("show");
      document.getElementById("top-username").textContent = name;
      document.getElementById("welcome-name").textContent = name;
      // admin?
      if (name.toLowerCase() === ADMIN_NAME) {
        document.getElementById("admin-toggle-btn").style.display = "inline-flex";
      } else {
        document.getElementById("admin-toggle-btn").style.display = "none";
        document.getElementById("admin-panel").classList.remove("show");
      }
      renderActivity();
      renderSnippets();
      loadGithubSettings();
    }

    function handleLogout() {
      const u = localStorage.getItem(LS_USER_KEY);
      logActivity("logout", "User logged out: " + u);
      localStorage.removeItem(LS_USER_KEY);
      document.getElementById("app-screen").classList.remove("show");
      document.getElementById("login-screen").classList.add("show");
    }

    // on load, restore session
    (function init() {
      const existing = localStorage.getItem(LS_USER_KEY);
      if (existing) {
        showApp(existing);
      }
    })();

    // ========= ACTIVITY =========
    function logActivity(type, msg) {
      const arr = JSON.parse(localStorage.getItem(LS_ACTIVITY_KEY) || "[]");
      arr.push({
        ts: new Date().toISOString(),
        type,
        msg
      });
      localStorage.setItem(LS_ACTIVITY_KEY, JSON.stringify(arr));
      renderActivity();
    }

    function renderActivity() {
      const box = document.getElementById("activity-log");
      const arr = JSON.parse(localStorage.getItem(LS_ACTIVITY_KEY) || "[]").reverse();
      if (arr.length === 0) {
        box.innerHTML = "<div class='small'>No activity yet.</div>";
        return;
      }
      box.innerHTML = arr.map(item => {
        const t = new Date(item.ts).toLocaleString();
        return `<div class="act-item">
          <div><b>${item.type}</b> â€” ${item.msg}</div>
          <div class="act-time">${t}</div>
        </div>`;
      }).join("");
    }

    function clearActivity() {
      if (!confirm("Clear entire activity log?")) return;
      localStorage.setItem(LS_ACTIVITY_KEY, "[]");
      renderActivity();
    }

    // ========= UPLOAD / SNIPPET SIDE =========
    function saveLocalSnippet() {
      const txt = document.getElementById("quick-script").value;
      if (!txt.trim()) {
        document.getElementById("local-snippet-status").textContent = "Nothing to save.";
        return;
      }
      const arr = JSON.parse(localStorage.getItem(LS_SNIPPETS_KEY) || "[]");
      arr.push({
        ts: Date.now(),
        content: txt
      });
      localStorage.setItem(LS_SNIPPETS_KEY, JSON.stringify(arr));
      document.getElementById("local-snippet-status").textContent = "Saved locally.";
      logActivity("snippet_save","Snippet saved to local");
      renderSnippets();
    }

    function renderSnippets() {
      const arr = JSON.parse(localStorage.getItem(LS_SNIPPETS_KEY) || "[]").reverse();
      const box = document.getElementById("snippet-list");
      if (arr.length === 0) {
        box.textContent = "No saved snippets yet.";
        return;
      }
      box.innerHTML = arr.map((s, i) => {
        return `<div style="margin-bottom:6px;">
          <b>#${arr.length - i}</b> Â· ${new Date(s.ts).toLocaleString()}
          <div style="white-space:pre-wrap;background:rgba(0,0,0,0.25);padding:3px 4px;border-radius:6px;margin-top:3px;max-height:80px;overflow-y:auto;">${escapeHtml(s.content)}</div>
        </div>`;
      }).join("");
    }

    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, function(m) {
        return ({
          "&":"&amp;",
          "<":"&lt;",
          ">":"&gt;",
          '"':"&quot;",
          "'":"&#39;"
        })[m];
      });
    }

    // ========= ADMIN PANEL =========
    function toggleAdmin() {
      const p = document.getElementById("admin-panel");
      p.classList.toggle("show");
    }

    function loadGithubSettings() {
      const raw = localStorage.getItem(LS_GH_SETTINGS);
      if (!raw) return;
      try {
        const cfg = JSON.parse(raw);
        if (cfg.repo) document.getElementById("gh-user").value = cfg.repo;
        if (cfg.token) document.getElementById("gh-token").value = cfg.token;
        if (cfg.path) document.getElementById("gh-path").value = cfg.path;
      } catch(e) {}
    }

    async function pushToGithub() {
      const repo = document.getElementById("gh-user").value.trim();
      const token = document.getElementById("gh-token").value.trim();
      const path = document.getElementById("gh-path").value.trim();
      const msg = document.getElementById("gh-message").value.trim() || "Infinity auto commit";
      const content = document.getElementById("gh-file-content").value;
      const stat = document.getElementById("gh-status");

      if (!repo || !token || !path) {
        stat.innerHTML = "<span class='status-bad'>Repo / token / path required.</span>";
        return;
      }

      // save settings
      localStorage.setItem(LS_GH_SETTINGS, JSON.stringify({ repo, token, path }));

      // GitHub needs base64 content
      const b64 = btoa(unescape(encodeURIComponent(content)));

      // first, try to get existing file to get SHA
      const url = `https://api.github.com/repos/${repo}/contents/${path}`;
      let sha = null;
      try {
        const resp = await fetch(url, {
          headers: { "Authorization": "token " + token }
        });
        if (resp.ok) {
          const data = await resp.json();
          sha = data.sha;
        }
      } catch(e) {
        // ignore; maybe file doesn't exist
      }

      const body = {
        message: msg,
        content: b64
      };
      if (sha) body.sha = sha;

      try {
        const resp = await fetch(url, {
          method: "PUT",
          headers: {
            "Authorization": "token " + token,
            "Accept": "application/vnd.github+json"
          },
          body: JSON.stringify(body)
        });
        const data = await resp.json();
        if (resp.ok) {
          stat.innerHTML = "<span class='status-ok'>Pushed to GitHub: " + (data.content && data.content.path ? data.content.path : "") + "</span>";
          logActivity("github_push","Pushed " + path + " to " + repo);
        } else {
          stat.innerHTML = "<span class='status-bad'>GitHub error: " + (data.message || resp.status) + "</span>";
        }
      } catch(e) {
        stat.innerHTML = "<span class='status-bad'>Network/Browser blocke