<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Infinity Portal ¬∑ PewPi</title>
  <style>
    :root {
      --bg-dark: #0a0e1a;
      --bg-panel: #141827;
      --bg-card: #1a1f35;
      --accent-primary: #00d4ff;
      --accent-secondary: #7b2cbf;
      --text-primary: #e9ecef;
      --text-muted: #8b95a8;
      --danger: #f43f5e;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
      background:linear-gradient(135deg,#0a0e1a,#1a1f35);
      color:var(--text-primary);
      min-height:100vh;
    }
    .header{
      background:var(--bg-panel);
      border-bottom:1px solid rgba(0,212,255,.2);
      padding:16px 20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      position:sticky;top:0;z-index:10;
    }
    .logo{
      font-size:26px;
      font-weight:800;
      background:linear-gradient(135deg,var(--accent-primary),#fff);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .ai-badge{
      background:rgba(0,212,255,.12);
      border:1px solid rgba(0,212,255,.3);
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
    }
    .user-area{display:flex;gap:12px;align-items:center}
    .btn{
      background:rgba(0,212,255,.1);
      border:1px solid rgba(0,212,255,.4);
      color:var(--text-primary);
      border-radius:7px;
      padding:6px 14px;
      cursor:pointer;
      font-weight:600;
    }
    .container{max-width:1100px;margin:0 auto;padding:24px 16px 70px}
    .welcome{
      background:var(--bg-panel);
      border:1px solid rgba(0,212,255,.2);
      border-radius:20px;
      padding:28px;
      margin-bottom:24px;
      box-shadow:0 0 25px rgba(0,212,255,.08);
    }
    .welcome h1{font-size:32px;margin-bottom:7px}
    .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;margin-top:20px}
    .stat{background:rgba(0,0,0,.2);border:1px solid rgba(0,212,255,.08);border-radius:14px;padding:14px}
    .stat-label{font-size:11px;text-transform:uppercase;color:var(--text-muted);letter-spacing:.4px}
    .stat-value{font-size:26px;font-weight:700;margin-top:4px;color:var(--accent-primary)}
    .panel{
      background:var(--bg-panel);
      border:1px solid rgba(0,212,255,.15);
      border-radius:18px;
      padding:20px;
      margin-bottom:24px;
    }
    .panel-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .log-list{max-height:360px;overflow:auto}
    .log-item{
      background:rgba(0,0,0,.25);
      border-left:3px solid var(--accent-primary);
      border-radius:10px;
      padding:10px 12px;
      margin-bottom:10px;
    }
    .log-time{font-size:11px;color:var(--text-muted)}
    .log-action{font-weight:600}
    /* login overlay */
    .login-overlay{
      position:fixed;inset:0;
      background:rgba(4,6,10,.92);
      display:flex;align-items:center;justify-content:center;
      z-index:999;
    }
    .login-box{
      background:var(--bg-panel);
      border:1px solid rgba(0,212,255,.3);
      border-radius:18px;
      padding:26px 22px;
      width:min(92vw,380px);
      text-align:center;
    }
    .login-box h2{margin-bottom:4px}
    .login-box p{color:var(--text-muted);margin-bottom:14px}
    .field{margin-bottom:13px;text-align:left}
    .field label{font-size:13px;display:block;margin-bottom:4px}
    .field input{
      width:100%;padding:8px 10px;border-radius:8px;border:1px solid rgba(0,212,255,.25);
      background:rgba(0,0,0,.2);color:var(--text-primary);
    }
    /* admin panel */
    .admin-btn{display:none;}
    .admin-panel{
      position:fixed;right:16px;bottom:16px;
      width:min(95vw,360px);
      background:#0b1020;
      border:1px solid rgba(0,212,255,.3);
      border-radius:16px;
      box-shadow:0 20px 60px rgba(0,0,0,.3);
      padding:14px;
      display:none;
      z-index:998;
    }
    .admin-panel h3{margin-bottom:8px}
    .admin-panel small{color:var(--text-muted);font-size:11px}
    .admin-panel .row{margin-bottom:8px}
    .admin-panel input, .admin-panel textarea{
      width:100%;background:rgba(255,255,255,.02);border:1px solid rgba(0,212,255,.25);color:#fff;border-radius:6px;padding:6px 8px;font-size:13px;
    }
    .admin-panel textarea{min-height:90px;resize:vertical}
    .danger{background:rgba(244,63,94,.12);border:1px solid rgba(244,63,94,.4);color:#fff}
    @media(max-width:700px){
      .header{flex-wrap:wrap;gap:8px}
      .welcome h1{font-size:26px}
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="header">
    <div>
      <div class="logo">PEWPI ¬∑ INFINITY</div>
      <div class="ai-badge">AI Shadow Agent ¬∑ Secure</div>
    </div>
    <div class="user-area">
      <span id="top-username">Not signed in</span>
      <button class="btn danger" id="logout-btn">Logout</button>
      <button class="btn admin-btn" id="open-admin">Admin</button>
    </div>
  </div>
  <!-- MAIN -->
  <div class="container" id="main-ui" style="display:none">
    <div class="welcome">
      <h1>Welcome back, <span id="welcome-name"></span> üîê</h1>
      <p>Your Infinity / PewPi session is protected.</p>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Total activities</div>
          <div class="stat-value" id="stat-total">0</div>
        </div>
        <div class="stat">
          <div class="stat-label">Session status</div>
          <div class="stat-value" style="color:#22c55e">Active</div>
        </div>
        <div class="stat">
          <div class="stat-label">Security level</div>
          <div class="stat-value">MAX</div>
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="panel-title">
        <h2>Activity timeline</h2>
        <button class="btn danger" id="clear-log">Clear</button>
      </div>
      <div class="log-list" id="log-list"></div>
    </div>
  </div>
  <!-- LOGIN OVERLAY -->
  <div class="login-overlay" id="login-layer">
    <div class="login-box">
      <h2>PewPi / Infinity Login</h2>
      <p>Enter your Infinity name. Use <b>Kris</b> to unlock admin.</p>
      <div class="field">
        <label>Username</label>
        <input id="login-name" placeholder="e.g. Kris" />
      </div>
      <div class="field">
        <label>Password (anything for now)</label>
        <input id="login-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </div>
      <button class="btn" id="do-login" style="width:100%;margin-top:4px;">Login</button>
    </div>
  </div>
  <!-- ADMIN PANEL -->
  <div class="admin-panel" id="admin-panel">
    <h3>Infinity Admin</h3>
    <small>Paste your GitHub token & repo info. Then ‚ÄúPush current page ‚Üí GitHub‚Äù.</small>
    <div class="row">
      <label style="font-size:12px;">GitHub Token</label>
      <input type="password" id="gh-token" placeholder="ghp_..." />
    </div>
    <div class="row">
      <label style="font-size:12px;">Owner / Username</label>
      <input id="gh-owner" value="Pewpi-infinity" />
    </div>
    <div class="row">
      <label style="font-size:12px;">Repo name</label>
      <input id="gh-repo" value="Infinity-Vectors" />
    </div>
    <div class="row">
      <label style="font-size:12px;">File path in repo</label>
      <input id="gh-path" value="index.html" />
    </div>
    <div class="row">
      <label style="font-size:12px;">Commit message</label>
      <input id="gh-msg" value="update from Infinity portal" />
    </div>
    <button class="btn" id="push-btn" style="width:100%;margin-top:6px;">‚¨Ü Push current page ‚Üí GitHub</button>
    <p id="admin-status" style="margin-top:8px;font-size:12px;color:var(--text-muted);"></p>
  </div>

  <script>
    // --- basics ---
    const loginLayer = document.getElementById('login-layer');
    const mainUI = document.getElementById('main-ui');
    const topUser = document.getElementById('top-username');
    const welcomeName = document.getElementById('welcome-name');
    const logList = document.getElementById('log-list');
    const statTotal = document.getElementById('stat-total');
    const adminBtn = document.getElementById('open-admin');
    const adminPanel = document.getElementById('admin-panel');

    function loadLogs() {
      const logs = JSON.parse(localStorage.getItem('infinity_activity_log') || '[]').sort((a,b)=>b.time-a.time);
      logList.innerHTML = '';
      logs.forEach(l => {
        const d = document.createElement('div');
        d.className = 'log-item';
        d.innerHTML = `
          <div class="log-time">${new Date(l.time).toLocaleString()}</div>
          <div class="log-action">${l.action}</div>
          <div style="font-size:12px;color:var(--text-muted);">${l.details}</div>
        `;
        logList.appendChild(d);
      });
      statTotal.textContent = logs.length;
    }
    function addLog(action,details){
      const logs = JSON.parse(localStorage.getItem('infinity_activity_log') || '[]');
      logs.push({time:Date.now(),action,details});
      localStorage.setItem('infinity_activity_log', JSON.stringify(logs));
      loadLogs();
    }

    function showAdminIfKris(name){
      if(name && name.toLowerCase()==='kris'){
        adminBtn.style.display='inline-block';
      } else {
        adminBtn.style.display='none';
      }
    }

    // init auth
    const storedUser = localStorage.getItem('infinity_current_user');
    if (storedUser){
      loginLayer.style.display='none';
      mainUI.style.display='block';
      topUser.textContent = storedUser;
      welcomeName.textContent = storedUser;
      showAdminIfKris(storedUser);
      loadLogs();
    }

    document.getElementById('do-login').onclick = () => {
      const name = document.getElementById('login-name').value.trim();
      const pass = document.getElementById('login-pass').value.trim();
      if(!name){ alert('enter name'); return; }
      // save session
      localStorage.setItem('infinity_current_user', name);
      localStorage.setItem('infinity_session_token', 'session-'+Date.now());
      loginLayer.style.display='none';
      mainUI.style.display='block';
      topUser.textContent = name;
      welcomeName.textContent = name;
      showAdminIfKris(name);
      addLog('user_login', `User ${name} logged in`);
    };

    document.getElementById('logout-btn').onclick = () => {
      const u = localStorage.getItem('infinity_current_user') || 'user';
      addLog('user_logout', u + ' logged out');
      localStorage.removeItem('infinity_current_user');
      localStorage.removeItem('infinity_session_token');
      loginLayer.style.display='flex';
      mainUI.style.display='none';
      topUser.textContent = 'Not signed in';
    };

    document.getElementById('clear-log').onclick = () => {
      localStorage.setItem('infinity_activity_log','[]');
      loadLogs();
    };

    // admin toggle
    adminBtn.onclick = () => {
      adminPanel.style.display = (adminPanel.style.display==='block') ? 'none':'block';
    };

    // ========== GITHUB PUSH ==========
    async function pushToGitHub() {
      const status = document.getElementById('admin-status');
      status.style.color = 'var(--text-muted)';
      status.textContent = 'Preparing...';
      const token = document.getElementById('gh-token').value.trim();
      const owner = document.getElementById('gh-owner').value.trim();
      const repo = document.getElementById('gh-repo').value.trim();
      const path = document.getElementById('gh-path').value.trim() || 'index.html';
      const msg = document.getElementById('gh-msg').value.trim() || 'update from Infinity portal';
      if (!token){ status.style.color='tomato'; status.textContent='Missing token.'; return; }

      // grab current page HTML
      const html = document.documentElement.outerHTML;
      const base64 = btoa(unescape(encodeURIComponent(html)));

      // we must first get the file SHA (if file exists)
      const apiBase = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
      let sha = null;
      try {
        const getRes = await fetch(apiBase, {
          headers: {
            "Authorization": "Bearer " + token,
            "Accept": "application/vnd.github+json"
          }
        });
        if (getRes.ok){
          const existing = await getRes.json();
          sha = existing.sha;
        }
      } catch (e) {
        // ignore, maybe file doesn't exist
      }

      // now PUT
      try {
        const putRes = await fetch(apiBase, {
          method: "PUT",
          headers: {
            "Authorization": "Bearer " + token,
            "Accept": "application/vnd.github+json"
          },
          body: JSON.stringify({
            message: msg,
            content: base64,
            sha: sha || undefined
          })
        });
        const data = await putRes.json();
        if (putRes.ok){
          status.style.color = '#22c55e';
          status.textContent = 'Pushed ‚úÖ Commit: ' + (data.commit && data.commit.sha ? data.commit.sha.substring(0,7) : '');
          addLog('push_success', `Pushed ${path} to ${owner}/${repo}`);
        } else {
          status.style.color = 'tomato';
          status.textContent = 'GitHub said no: ' + (data.message || putRes.status);
          addLog('push_failed', data.message || 'unknown');
        }
      } catch (err) {
        status.style.color = 'tomato';
        status.textContent = 'Fetch failed (if you opened index.html directly, run it over http).';
      }
    }

    document.getElementById('push-btn').onclick = pushToGitHub;
  </script>
</body>
</html>
