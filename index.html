<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Infinity Portal ¬∑ Single File Build</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-dark: #0a0e1a;
      --bg-panel: #141827;
      --bg-card: #1a1f35;
      --accent-primary: #00d4ff;
      --accent-secondary: #7b2cbf;
      --text-primary: #e9ecef;
      --text-muted: #8b95a8;
      --border-glow: rgba(0, 212, 255, 0.3);
      --success-color: #22c55e;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 100%);
      min-height: 100vh;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      color: var(--text-primary);
    }

    /* -------- login screen ---------- */
    #login-screen {
      display: none;
      min-height: 100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:1rem;
      padding:1.5rem;
    }
    .login-card {
      background: rgba(10,14,26,.85);
      border: 1px solid rgba(0,212,255,.16);
      border-radius: 16px;
      padding: 1.4rem 1.3rem 1.1rem;
      width: min(360px, 100%);
      box-shadow: 0 18px 30px rgba(0,0,0,.35);
    }
    .login-card h1 {
      font-size: 1rem;
      margin-bottom: .45rem;
      background: linear-gradient(135deg, #00d4ff, #fff);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .login-card label {
      display:block;
      font-size:.65rem;
      margin-top:.35rem;
      margin-bottom:.2rem;
      color: rgba(233,236,239,.8);
    }
    .login-card input {
      width: 100%;
      background: rgba(20,24,39,.7);
      border: 1px solid rgba(255,255,255,.05);
      border-radius: .45rem;
      padding: .4rem .5rem;
      color:#fff;
      font-size:.7rem;
    }
    .login-actions {
      display:flex;
      gap:.45rem;
      margin-top:.6rem;
    }
    .btn {
      border:none;
      border-radius:.45rem;
      padding:.35rem .7rem;
      font-size:.65rem;
      cursor:pointer;
      font-weight:600;
    }
    .btn-primary {
      background: var(--accent-primary);
      color:#000;
    }
    .btn-ghost {
      background: rgba(255,255,255,.05);
      color:#fff;
      border:1px solid rgba(255,255,255,.03);
    }
    .login-foot {
      margin-top:.55rem;
      font-size:.55rem;
      color: rgba(233,236,239,.5);
    }

    /* ---------- header / layout ---------- */
    #app-shell { display:none; min-height:100vh; }
    .header {
      background: #141827aa;
      border-bottom:1px solid rgba(0,212,255,.15);
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: .8rem 1.2rem;
      backdrop-filter: blur(8px);
      position:sticky;
      top:0;
      z-index:5;
    }
    .logo-area { display:flex; gap:.5rem; align-items:center; }
    .logo-text {
      font-weight:900;
      letter-spacing:1.4px;
      background: linear-gradient(135deg, #00d4ff, #7b2cbf);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      font-size:1.1rem;
    }
    .ai-badge {
      font-size:.58rem;
      background: rgba(0,212,255,.08);
      border: 1px solid rgba(0,212,255,.25);
      padding:.2rem .4rem;
      border-radius:999px;
    }
    .user-info { display:flex; gap:.6rem; align-items:center; }
    .user-name { font-size:.65rem; }
    .logout-btn {
      background: rgba(239,68,68,.08);
      border:1px solid rgba(239,68,68,.35);
      color:#fca5a5;
      border-radius:.4rem;
      padding:.25rem .6rem;
      font-size:.62rem;
      cursor:pointer;
    }

    .container {
      max-width:1200px;
      margin: 1.2rem auto 1.5rem;
      padding: 0 .8rem 1.2rem;
      display:grid;
      grid-template-columns: minmax(0,1fr) 260px;
      gap:1rem;
    }
    @media (max-width: 900px) {
      .container { grid-template-columns: 1fr; }
    }

    /* ---------- main panel ---------- */
    .panel {
      background: rgba(20,24,39,.5);
      border:1px solid rgba(0,212,255,.1);
      border-radius:1rem;
      padding:1rem;
      box-shadow:0 10px 30px rgba(0,0,0,.38);
    }
    .welcome-title {
      font-size:1.3rem;
      margin-bottom:.45rem;
    }
    .welcome-sub {
      font-size:.7rem;
      color: var(--text-muted);
      margin-bottom:.6rem;
    }
    .stats-grid {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap:.6rem;
    }
    .stat-card {
      background: rgba(10,14,26,.4);
      border:1px solid rgba(0,212,255,.08);
      border-radius:.6rem;
      padding:.6rem .55rem;
    }
    .stat-label { font-size:.55rem; color:var(--text-muted); text-transform:uppercase; }
    .stat-value { font-size:1.1rem; margin-top:.2rem; }

    /* activity log */
    .activity-section { margin-top:1rem; }
    .activity-section h2 { font-size:.8rem; margin-bottom:.5rem; display:flex; gap:.35rem; align-items:center; }
    .activity-log {
      max-height:420px;
      overflow-y:auto;
      display:flex;
      flex-direction:column;
      gap:.45rem;
    }
    .activity-item {
      background: rgba(9,12,21,.4);
      border-left:3px solid var(--accent-primary);
      border-radius:.45rem;
      padding:.4rem .5rem .5rem;
    }
    .activity-time { font-size:.52rem; color:var(--text-muted); }
    .activity-action { font-size:.7rem; font-weight:600; margin-top:.1rem; }
    .activity-details { font-size:.6rem; color:var(--text-muted); margin-top:.1rem; }
    .activity-narrator {
      margin-top:.3rem;
      background: rgba(0,212,255,.02);
      border-left:2px solid rgba(0,212,255,.7);
      padding:.25rem .4rem;
      font-size:.55rem;
      color: var(--accent-primary);
      border-radius:.4rem;
    }

    /* ---------- sidebar ---------- */
    .sidebar {
      display:flex;
      flex-direction:column;
      gap:1rem;
    }
    .sidebar-card {
      background: rgba(20,24,39,.5);
      border:1px solid rgba(0,212,255,.1);
      border-radius:1rem;
      padding:.7rem .6rem .65rem;
    }
    .sidebar-card h3 {
      font-size:.7rem;
      margin-bottom:.45rem;
    }
    .link-btn {
      display:block;
      width:100%;
      background: rgba(0,212,255,.04);
      border:1px solid rgba(0,212,255,.12);
      border-radius:.4rem;
      padding:.4rem .5rem;
      font-size:.6rem;
      color: #fff;
      text-align:left;
      cursor:pointer;
      margin-bottom:.3rem;
    }

    /* ---------- 3D cube ---------- */
    .cube-wrap {
      perspective: 600px;
      width:140px;
      height:140px;
      margin-top:.4rem;
    }
    .cube {
      width:100%;
      height:100%;
      position:relative;
      transform-style:preserve-3d;
      animation: spin 7s linear infinite;
    }
    .cube-face {
      position:absolute;
      width:100%;
      height:100%;
      background: linear-gradient(135deg, rgba(0,212,255,.45), rgba(123,44,191,.25));
      border:1px solid rgba(0,212,255,.35);
      border-radius:.6rem;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:.6rem;
      color:#fff;
    }
    .face-front { transform: translateZ(70px); }
    .face-back { transform: rotateY(180deg) translateZ(70px); }
    .face-right { transform: rotateY(90deg) translateZ(70px); }
    .face-left { transform: rotateY(-90deg) translateZ(70px); }
    .face-top { transform: rotateX(90deg) translateZ(70px); }
    .face-bottom { transform: rotateX(-90deg) translateZ(70px); }
    @keyframes spin {
      from { transform: rotateX(0deg) rotateY(0deg); }
      to   { transform: rotateX(360deg) rotateY(360deg); }
    }
  </style>
</head>
<body>

<!-- LOGIN SCREEN -->
<section id="login-screen">
  <div class="login-card">
    <h1>Infinity Login</h1>
    <p style="font-size:.6rem; color:rgba(255,255,255,.55); margin-bottom:.2rem;">
      Stored as <code>infinity_current_user</code> + <code>infinity_session_token</code>.
    </p>
    <label for="login-name">Name</label>
    <input id="login-name" placeholder="Kris" />
    <label for="login-email">Email (optional)</label>
    <input id="login-email" type="email" placeholder="you@example.com" />
    <div class="login-actions">
      <button class="btn btn-primary" onclick="doLogin()">Sign In</button>
      <button class="btn btn-ghost" onclick="doBypass()">Bypass</button>
    </div>
    <div id="login-msg" class="login-foot"></div>
  </div>
</section>

<!-- APP SHELL -->
<section id="app-shell">
  <header class="header">
    <div class="logo-area">
      <div class="logo-text">INFINITY</div>
      <div class="ai-badge">PewPi AI watcher ¬∑ online</div>
    </div>
    <div class="user-info">
      <div class="user-name">üë§ <span id="user-display"></span></div>
      <button class="logout-btn" onclick="handleLogout()">Logout</button>
    </div>
  </header>

  <div class="container">
    <main class="panel">
      <h2 class="welcome-title">Welcome back, <span id="welcome-name"></span> üöÄ</h2>
      <p class="welcome-sub">Your session is guarded. Every click earns tokens and is written to Infinity storage (local for now).</p>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Activity count</div>
          <div class="stat-value" id="stat-activities">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Infinity tokens</div>
          <div class="stat-value" id="stat-tokens">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Security</div>
          <div class="stat-value" style="color:var(--success-color);">Max</div>
        </div>
      </div>

      <div class="activity-section">
        <h2>Activity timeline <span style="font-size:.55rem; color:var(--text-muted);">AI shadow narrates below</span></h2>
        <div id="activity-log" class="activity-log"></div>
      </div>
    </main>

    <aside class="sidebar">
      <div class="sidebar-card">
        <h3>Infinity links</h3>
        <button class="link-btn" onclick="openInfinityPortal()">Open deployed portal</button>
        <button class="link-btn" onclick="recordAction('open_local_unified','Opened local unified portal (not wired)')">Local unified placeholder</button>
        <button class="link-btn" onclick="testActivity()">Test activity</button>
      </div>
      <div class="sidebar-card">
        <h3>3D core</h3>
        <p style="font-size:.55rem; color:var(--text-muted);">This is the vector box you wanted in-page.</p>
        <div class="cube-wrap">
          <div class="cube">
            <div class="cube-face face-front">‚àû</div>
            <div class="cube-face face-back">AI</div>
            <div class="cube-face face-right">Pew</div>
            <div class="cube-face face-left">Pi</div>
            <div class="cube-face face-top">Sec</div>
            <div class="cube-face face-bottom">Log</div>
          </div>
        </div>
      </div>
      <div class="sidebar-card">
        <h3>Raw JSON (local)</h3>
        <p id="json-dump" style="font-size:.48rem; word-break:break-word; max-height:120px; overflow:auto; background:rgba(0,0,0,.15); padding:.3rem .2rem; border-radius:.4rem;"></p>
      </div>
    </aside>
  </div>
</section>

<script>
  // KEYS (match your live portal)
  const USER_KEY = 'infinity_current_user';
  const SESSION_KEY = 'infinity_session_token';
  const ACTIVITY_KEY = 'infinity_activity_log';
  const TOKEN_KEY = 'infinity_token_ledger';

  // ----- LOGIN -----
  function showLogin() {
    document.getElementById('login-screen').style.display = 'flex';
    document.getElementById('app-shell').style.display = 'none';
  }
  function showApp() {
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('app-shell').style.display = 'block';
  }

  function doLogin() {
    const name = document.getElementById('login-name').value.trim();
    const email = document.getElementById('login-email').value.trim();
    if (!name && !email) {
      document.getElementById('login-msg').textContent = 'Enter a name or email.';
      return;
    }
    const user = name || email;
    localStorage.setItem(USER_KEY, user);
    localStorage.setItem(SESSION_KEY, 'token-' + Date.now());
    logActivity('user_login', 'User logged in via single-file vector build');
    ensureTokenBucket(user);
    renderApp();
  }

  function doBypass() {
    const user = 'Infinity Admin';
    localStorage.setItem(USER_KEY, user);
    localStorage.setItem(SESSION_KEY, 'token-' + Date.now());
    logActivity('user_login', 'Bypass login as Infinity Admin');
    ensureTokenBucket(user);
    renderApp();
  }

  function handleLogout() {
    const user = localStorage.getItem(USER_KEY) || 'unknown';
    logActivity('user_logout', 'User logged out: ' + user);
    localStorage.removeItem(USER_KEY);
    localStorage.removeItem(SESSION_KEY);
    showLogin();
  }

  // ----- ACTIVITY / TOKENS -----
  function getActivities() {
    try {
      return JSON.parse(localStorage.getItem(ACTIVITY_KEY) || '[]');
    } catch (e) {
      return [];
    }
  }

  function logActivity(action, details) {
    const user = localStorage.getItem(USER_KEY) || 'system';
    const list = getActivities();
    const payload = {
      timestamp: new Date().toISOString(),
      action,
      details,
      user
    };
    list.push(payload);
    localStorage.setItem(ACTIVITY_KEY, JSON.stringify(list));
    // token payout per action
    payTokens(user, 1, action);
    // stub for server
    sendToInfinityServer(payload);
    // re-render
    renderActivity();
  }

  function payTokens(user, amount, reason) {
    const ledger = getTokenLedger();
    if (!ledger[user]) ledger[user] = 0;
    ledger[user] += amount;
    localStorage.setItem(TOKEN_KEY, JSON.stringify(ledger));
    renderTokens();
    // also log once in JSON view
    dumpJSON();
  }

  function getTokenLedger() {
    try {
      return JSON.parse(localStorage.getItem(TOKEN_KEY) || '{}');
    } catch (e) {
      return {};
    }
  }

  function sendToInfinityServer(entry) {
    // placeholder ‚Äî later you can:
    // fetch('https://your-static-endpoint/collector', {method:'POST', body:JSON.stringify(entry)});
  }

  function renderActivity() {
    const wrap = document.getElementById('activity-log');
    const list = getActivities().slice().reverse();
    if (!list.length) {
      wrap.innerHTML = '<div style="font-size:.55rem; color:var(--text-muted);">No activities yet. This page will never auto-clear.</div>';
    } else {
      wrap.innerHTML = list.map(log => {
        const when = new Date(log.timestamp).toLocaleString();
        const narr = generateNarration(log.action, log.details, log.user);
        return `
          <div class="activity-item">
            <div class="activity-time">‚è± ${when}</div>
            <div class="activity-action">${getActionEmoji(log.action)} ${getActionTitle(log.action)}</div>
            <div class="activity-details">${log.details}</div>
            <div class="activity-narrator"><strong>AI:</strong> ${narr}</div>
          </div>
        `;
      }).join('');
    }
    document.getElementById('stat-activities').textContent = getActivities().length;
    dumpJSON();
  }

  function renderTokens() {
    const user = localStorage.getItem(USER_KEY);
    const ledger = getTokenLedger();
    const amt = user ? (ledger[user] || 0) : 0;
    document.getElementById('stat-tokens').textContent = amt;
  }

  // narration helpers
  function getActionEmoji(action) {
    const map = {
      user_login: 'üîì',
      user_logout: 'üîí',
      test_action: 'üß™',
      page_view: 'üëÅ',
    };
    return map[action] || 'üìå';
  }
  function getActionTitle(action) {
    const map = {
      user_login: 'User Login',
      user_logout: 'User Logout',
      test_action: 'Test Action',
      page_view: 'Page View'
    };
    return map[action] || 'Activity';
  }
  function generateNarration(action, details, user) {
    if (action === 'user_login') {
      return `${user} entry accepted. PewPi dual-AI verified local browser identity.`;
    }
    if (action === 'user_logout') {
      return `Session sealed for ${user}. Activity kept for receipts ‚Äî no purge.`;
    }
    if (action === 'test_action') {
      return `Test bubble fired. This is how Infinity will narrate and award tokens in live mode.`;
    }
    return `${user} performed ${action}. Details: ${details}`;
  }

  // ----- ACTION BUTTONS -----
  function testActivity() {
    recordAction('test_action', 'Developer fired a test activity');
  }
  function recordAction(action, details) {
    logActivity(action, details);
  }
  function openInfinityPortal() {
    recordAction('open_deployed_portal', 'User opened https://pewpi-infinity.github.io/infinity-portal/login.html');
    window.open('https://pewpi-infinity.github.io/infinity-portal/login.html', '_blank');
  }

  // ----- RENDER APP -----
  function renderApp() {
    const user = localStorage.getItem(USER_KEY);
    if (!user) { showLogin(); return; }
    showApp();
    document.getElementById('user-display').textContent = user;
    document.getElementById('welcome-name').textContent = user;
    renderActivity();
    renderTokens();
    // record current view
    logActivity('page_view', 'Vector single-file portal viewed');
  }

  function ensureTokenBucket(user) {
    const ledger = getTokenLedger();
    if (!ledger[user]) {
      ledger[user] = 3; // welcome gift
      localStorage.setItem(TOKEN_KEY, JSON.stringify(ledger));
    }
  }

  function dumpJSON() {
    const dump = {
      user: localStorage.getItem(USER_KEY),
      session: localStorage.getItem(SESSION_KEY),
      activity_log: getActivities(),
      tokens: getTokenLedger()
    };
    document.getElementById('json-dump').textContent = JSON.stringify(dump, null, 2);
  }

  // on boot
  (function init() {
    const user = localStorage.getItem(USER_KEY);
    const token = localStorage.getItem(SESSION_KEY);
    if (user && token) {
      renderApp();
    } else {
      showLogin();
    }
  })();
</script>

</body>
</html>
