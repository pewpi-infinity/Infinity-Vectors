<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Infinity Â· PewPi Portal</title>
  <style>
    :root {
      --bg: #0a0e1a;
      --panel: #141827;
      --card: #1a1f35;
      --accent: #00d4ff;
      --accent2: #7b2cbf;
      --text: #eef3ff;
      --muted: #8b95a8;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      background:linear-gradient(135deg,#0a0e1a 0%,#1a1f35 100%);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      min-height:100vh;
    }
    header{
      background:var(--panel);
      padding:14px 20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid rgba(0,212,255,.25);
      position:sticky;top:0;z-index:10;
    }
    .logo{
      font-weight:800;
      letter-spacing:2px;
      font-size:20px;
      background:linear-gradient(135deg,var(--accent),#fff);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .container{max-width:1200px;margin:20px auto;padding:0 14px;}
    .card{
      background:var(--panel);
      border:1px solid rgba(0,212,255,0.18);
      border-radius:16px;
      padding:20px;
      margin-bottom:20px;
      box-shadow:0 20px 50px rgba(0,0,0,.35);
    }
    .title{font-size:24px;margin-bottom:6px;}
    .muted{color:var(--muted);font-size:14px}
    /* login */
    #login-box{
      max-width:420px;margin:50px auto;
      background:var(--panel);
      padding:26px;
      border-radius:18px;
      border:1px solid rgba(0,212,255,0.2);
      box-shadow:0 15px 40px rgba(0,0,0,0.4);
    }
    #login-box h1{margin-bottom:14px;}
    .input-row{margin-bottom:14px;}
    .input-row label{display:block;margin-bottom:5px;font-size:13px;color:var(--muted);}
    .input-row input{
      width:100%;padding:10px 12px;border-radius:10px;
      border:1px solid rgba(255,255,255,.07);
      background:#0f1321;color:#fff;
    }
    .btn{
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      border:none;color:#fff;padding:10px 14px;border-radius:10px;
      font-weight:600;cursor:pointer;
    }
    .dash-grid{
      display:grid;gap:16px;
      grid-template-columns:2fr 1fr;
    }
    #activity-log{max-height:360px;overflow-y:auto;margin-top:14px;}
    .activity-item{
      background:rgba(0,212,255,.03);
      border-left:3px solid var(--accent);
      padding:10px 14px;
      border-radius:8px;
      margin-bottom:10px;
    }
    /* admin panel */
    #admin-panel{
      margin-top:20px;
      background:#0f1321;
      border:1px solid rgba(255,255,255,0.06);
      border-radius:12px;
      padding:14px;
      display:none;
    }
    #admin-panel h3{margin-bottom:10px;}
    #admin-panel input{
      width:100%;padding:8px 10px;border-radius:8px;
      border:1px solid rgba(255,255,255,.05);background:#0a0d17;color:#fff;
      margin-bottom:8px;
    }
    #admin-status{margin-top:6px;font-size:13px;}
    @media(max-width:850px){
      .dash-grid{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">INFINITY Â· PEWPI</div>
    <div id="top-user" class="muted"></div>
  </header>

  <!-- LOGIN SCREEN -->
  <div id="login-box" style="display:none;">
    <h1>Infinity Login</h1>
    <p class="muted" style="margin-bottom:14px;">PewPi AI-to-AI encrypted portal</p>
    <div class="input-row">
      <label>Username</label>
      <input id="login-username" placeholder="Kris"/>
    </div>
    <div class="input-row">
      <label>Password</label>
      <input id="login-password" type="password" placeholder="anything for now"/>
    </div>
    <button class="btn" onclick="doLogin()">Enter Portal</button>
    <div id="login-status" class="muted" style="margin-top:10px;"></div>
  </div>

  <!-- DASHBOARD -->
  <div class="container" id="dashboard" style="display:none;">
    <div class="card">
      <div class="title">Welcome back, <span id="dash-user"></span> ðŸš€</div>
      <div class="muted">Your Infinity Portal is active. AI shadow agent is logging events.</div>
    </div>

    <div class="dash-grid">
      <div class="card">
        <h2>Activity timeline</h2>
        <button class="btn" style="margin-top:8px;" onclick="testActivity()">Add test activity</button>
        <div id="activity-log"></div>
      </div>
      <div>
        <div class="card">
          <h2>Session Stats</h2>
          <p class="muted">Total activities: <span id="activity-count">0</span></p>
          <p class="muted">Security level: Maximum</p>
          <p class="muted">Portal: PEWPI Infinity Vectors</p>
        </div>
        <div id="admin-panel">
          <h3>Admin: push this page to GitHub</h3>
          <input id="gh-owner" placeholder="GitHub owner / username (e.g. Pewpi-infinity)"/>
          <input id="gh-repo" placeholder="Repo name (e.g. Infinity-Vectors)"/>
          <input id="gh-path" value="index.html" placeholder="Path (index.html)"/>
          <input id="gh-msg" value="update from portal" placeholder="Commit message"/>
          <button class="btn" id="push-btn">Push to GitHub</button>
          <div id="admin-status" class="muted"></div>
        </div>
      </div>
    </div>
  </div>

<script>
/* ===== AUTH + UI ===== */
function showLogin(){
  document.getElementById('login-box').style.display='block';
  document.getElementById('dashboard').style.display='none';
}
function showDash(user){
  document.getElementById('login-box').style.display='none';
  document.getElementById('dashboard').style.display='block';
  document.getElementById('dash-user').textContent = user;
  document.getElementById('top-user').textContent = 'ðŸ‘¤ ' + user;
  loadActivity();
  if(user.toLowerCase()==='kris'){
    document.getElementById('admin-panel').style.display='block';
  }
}
function checkAuth(){
  const u = localStorage.getItem('infinity_current_user');
  if(u){ showDash(u); } else { showLogin(); }
}
function doLogin(){
  const u = document.getElementById('login-username').value.trim();
  const p = document.getElementById('login-password').value.trim();
  // for now any password, but we log it
  if(!u){ document.getElementById('login-status').textContent='Enter a username'; return; }
  localStorage.setItem('infinity_current_user', u);
  localStorage.setItem('infinity_session_token', 'local-'+Date.now());
  logActivity('user_login', 'User logged in: '+u);
  showDash(u);
}
/* ===== ACTIVITY ===== */
function logActivity(action, details){
  const logs = JSON.parse(localStorage.getItem('infinity_activity_log') || '[]');
  logs.push({
    ts: new Date().toISOString(),
    action, details
  });
  localStorage.setItem('infinity_activity_log', JSON.stringify(logs));
  loadActivity();
}
function loadActivity(){
  const logs = JSON.parse(localStorage.getItem('infinity_activity_log') || '[]').reverse();
  const box = document.getElementById('activity-log');
  if(!box) return;
  if(logs.length===0){
    box.innerHTML = '<p class="muted">No activity yet.</p>';
  } else {
    box.innerHTML = logs.map(l => `
      <div class="activity-item">
        <div class="muted">${new Date(l.ts).toLocaleString()}</div>
        <div><strong>${l.action}</strong></div>
        <div class="muted">${l.details}</div>
      </div>
    `).join('');
  }
  document.getElementById('activity-count').textContent = logs.length;
}
function testActivity(){
  const u = localStorage.getItem('infinity_current_user') || 'user';
  logActivity('test_action', 'Test entry from '+u);
}
/* ===== PUSH TO GITHUB via LOCAL BACKEND ===== */
async function pushToGitHub(){
  const status = document.getElementById('admin-status');
  status.style.color = '#8b95a8';
  status.textContent = 'Contacting local backend...';

  const owner = document.getElementById('gh-owner').value.trim();
  const repo  = document.getElementById('gh-repo').value.trim();
  const path  = document.getElementById('gh-path').value.trim() || 'index.html';
  const msg   = document.getElementById('gh-msg').value.trim() || 'update from portal';

  if(!owner || !repo){
    status.style.color = 'tomato';
    status.textContent = 'Enter owner and repo first.';
    return;
  }

  const html = document.documentElement.outerHTML;
  try{
    const res = await fetch('http://127.0.0.1:5000/push', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        owner, repo, path, message: msg, content: html
      })
    });
    const data = await res.json();
    if(data.ok){
      status.style.color = '#22c55e';
      status.textContent = 'Pushed âœ…';
      logActivity('github_push', `Pushed ${path} to ${owner}/${repo}`);
    } else {
      status.style.color = 'tomato';
      status.textContent = 'GitHub error: ' + (data.error || (data.github && data.github.message) || data.status);
    }
  }catch(e){
    status.style.color = 'tomato';
    status.textContent = 'Could not reach http://127.0.0.1:5000/push. Make sure Termux server.py is running.';
  }
}
document.addEventListener('DOMContentLoaded', () => {
  checkAuth();
  const btn = document.getElementById('push-btn');
  if(btn) btn.addEventListener('click', pushToGitHub);
});
</script>
</body>
</html>
